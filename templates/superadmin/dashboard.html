{% extends 'base/admin_base.html' %}

{% block content %}
{% load static %}

                <!-- main Starts here -->
<link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">

                <div class="container-fluid">
                    <div class="layout-specing">
                        <h5 class="mb-0">Admin Dashboard</h5>

                        <div class="row">
                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-user h3 mb-0"></i>

                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{ all_users }}</h5>
                                            <p class="text-muted mb-0">Total Users</p>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end col-->

                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-file-medical-alt h3 mb-0"></i>
                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{males}}</h5>
                                            <p class="text-muted mb-0">Males</p>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end col-->

                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-social-distancing h3 mb-0"></i>
                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{females}}</h5>
                                            <p class="text-muted mb-0">Females</p>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end col-->

                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-ambulance h3 mb-0"></i>
                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{admins}}</h5>
                                            <p class="text-muted mb-0">Admins</p>
                                        </div>
                                    </div>

                                </div>
                            </div><!--end col-->

                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-medkit h3 mb-0"></i>
                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{managers}}</h5>
                                            <p class="text-muted mb-0">Managers</p>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end col-->

                            <div class="col-xl-2 col-lg-4 col-md-4 mt-4">
                                <div class="card features feature-primary rounded border-0 shadow p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="icon text-center rounded-md">
                                            <i class="uil uil-medical-drip h3 mb-0"></i>
                                        </div>
                                        <div class="flex-1 ms-2">
                                            <h5 class="mb-0">{{staff}}</h5>
                                            <p class="text-muted mb-0">Staff</p>
                                        </div>
                                    </div>
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->


                        <!--new diiiiiiiiiiiv row-->

<!-- ALL TABLES STARTS -->

<div class="container-fluid px-4">
    <!-- Combined Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">User Distribution Dashboard</h2>
            <p class="text-muted mb-0">Comprehensive overview of user distribution across different categories</p>
        </div>
        <div>
            <button class="btn btn-outline-primary" onclick="exportAllTables()">
                <i class="fas fa-file-export me-2"></i>Export All Data
            </button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="distributionTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="directorate-tab" data-bs-toggle="tab" data-bs-target="#directorate" type="button" role="tab">
                <i class="fas fa-building me-2"></i>Directorates
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="class-tab" data-bs-toggle="tab" data-bs-target="#class" type="button" role="tab">
                <i class="fas fa-users me-2"></i>Classes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="region-tab" data-bs-toggle="tab" data-bs-target="#region" type="button" role="tab">
                <i class="fas fa-map-marked-alt me-2"></i>Regions
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="management-tab" data-bs-toggle="tab" data-bs-target="#management" type="button" role="tab">
                <i class="fas fa-calculator me-2"></i>Management Units
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="distributionTabContent">
        <!-- Directorate Tab -->
        <div class="tab-pane fade show active" id="directorate" role="tabpanel">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-primary text-white py-3"
                     style="background: linear-gradient(90deg, #0056b3, #007bff);
                            border-bottom: 3px solid #004085;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"
                            style="font-weight: 600;
                                   letter-spacing: 0.5px;
                                   text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
                            <i class="fas fa-building me-2" style="color: #ffc107;"></i>
                            Directorate User Distribution
                        </h5>
                        <div class="badge bg-white text-primary rounded-pill"
                             style="padding: 8px 15px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #dee2e6;">
                            {{ num_of_departments }} Directorates
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="directorateTable" class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Directorate</th>
                                    <th scope="col">Number of Users</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept, count in department_data %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><i class="fas fa-building text-primary me-2"></i>{{ dept }}</td>
                                    <td class="fw-bold">{{ count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-light py-3 d-flex justify-content-between align-items-center">
                    <small class="text-muted">Last updated: {% now "DATETIME_FORMAT" %}</small>
                    <button class="btn btn-sm btn-outline-primary" onclick="exportTableToExcel('directorateTable', 'directorate_distribution')">
                        <i class="fas fa-file-export me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Class Tab -->
        <div class="tab-pane fade" id="class" role="tabpanel">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-primary text-white py-3"
                     style="background: linear-gradient(90deg, #0056b3, #007bff);
                            border-bottom: 3px solid #004085;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"
                            style="font-weight: 600;
                                   letter-spacing: 0.5px;
                                   text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
                            <i class="fas fa-users me-2" style="color: #ffc107;"></i>
                            Class User Distribution
                        </h5>
                        <div class="badge bg-white text-primary rounded-pill"
                             style="padding: 8px 15px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #dee2e6;">
                            {{ num_of_class }} Classes
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="classTable" class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Class</th>
                                    <th scope="col">Number of Users</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept, count in class_data %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><i class="fas fa-user-graduate text-primary me-2"></i>{{ dept }}</td>
                                    <td class="fw-bold">{{ count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-light py-3 d-flex justify-content-between align-items-center">
                    <small class="text-muted">Last updated: {% now "DATETIME_FORMAT" %}</small>
                    <button class="btn btn-sm btn-outline-primary" onclick="exportTableToExcel('classTable', 'class_distribution')">
                        <i class="fas fa-file-export me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Region Tab -->
        <div class="tab-pane fade" id="region" role="tabpanel">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-primary text-white py-3"
                     style="background: linear-gradient(90deg, #0056b3, #007bff);
                            border-bottom: 3px solid #004085;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"
                            style="font-weight: 600;
                                   letter-spacing: 0.5px;
                                   text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
                            <i class="fas fa-map-marked-alt me-2" style="color: #ffc107;"></i>
                            Region User Distribution
                        </h5>
                        <div class="badge bg-white text-primary rounded-pill"
                             style="padding: 8px 15px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #dee2e6;">
                            {{ num_of_region }} Regions
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="regionTable" class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Region</th>
                                    <th scope="col">Number of Users</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept, count in region_data %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><i class="fas fa-map-marker-alt text-primary me-2"></i>{{ dept }}</td>
                                    <td class="fw-bold">{{ count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-light py-3 d-flex justify-content-between align-items-center">
                    <small class="text-muted">Last updated: {% now "DATETIME_FORMAT" %}</small>
                    <button class="btn btn-sm btn-outline-primary" onclick="exportTableToExcel('regionTable', 'region_distribution')">
                        <i class="fas fa-file-export me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>

        <!-- Management Unit/Cost Centre Tab -->
        <div class="tab-pane fade" id="management" role="tabpanel">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-primary text-white py-3"
                     style="background: linear-gradient(90deg, #0056b3, #007bff);
                            border-bottom: 3px solid #004085;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"
                            style="font-weight: 600;
                                   letter-spacing: 0.5px;
                                   text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
                            <i class="fas fa-calculator me-2" style="color: #ffc107;"></i>
                            Management Unit/Cost Centre Distribution
                        </h5>
                        <div class="badge bg-white text-primary rounded-pill"
                             style="padding: 8px 15px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #dee2e6;">
                            {{ num_of_management }} Units
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="managementTable" class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Management Unit/Cost Centre</th>
                                    <th scope="col">Number of Users</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for dept, count in management_data %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><i class="fas fa-cash-register text-primary me-2"></i>{{ dept }}</td>
                                    <td class="fw-bold">{{ count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-light py-3 d-flex justify-content-between align-items-center">
                    <small class="text-muted">Last updated: {% now "DATETIME_FORMAT" %}</small>
                    <button class="btn btn-sm btn-outline-primary" onclick="exportTableToExcel('managementTable', 'management_distribution')">
                        <i class="fas fa-file-export me-1"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Scripts -->
<script>
    // Export single table
    function exportTableToExcel(tableID, filename) {
        let table = document.getElementById(tableID).outerHTML;
        let data = new Blob([table], {type: 'application/vnd.ms-excel'});
        let url = URL.createObjectURL(data);
        let a = document.createElement('a');
        a.href = url;
        a.download = filename + '.xls';
        a.click();
    }

    // Export all tables as a zip
    function exportAllTables() {
        // This would require a more complex implementation with JSZip library
        // For now, we'll just export each table individually
        exportTableToExcel('directorateTable', 'directorate_distribution');
        setTimeout(() => {
            exportTableToExcel('classTable', 'class_distribution');
        }, 500);
        setTimeout(() => {
            exportTableToExcel('regionTable', 'region_distribution');
        }, 1000);
        setTimeout(() => {
            exportTableToExcel('managementTable', 'management_distribution');
        }, 1500);
    }
</script>

<!-- Bootstrap JS for tabs -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ALL TABLES END -->
                    </div>
                </div>
                <!--main ends here -->

{% endblock %}